<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guitar Fretboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            user-select: none;
        }

        .fretboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .string {
            display: flex;
        }

        .fret {
            border-right: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background-color: #f0f0f0;
            position: relative;
            user-select: none;
            height: var(--fret-height, 40px);
        }

        .fret.hide-right-border {
            border-right: none;
        }

        .fret.highlight {
            background-color: #FFD700;
        }

        .fret.fret-12 {
            background-color: #FF6347;
        }

        .fret.fret-0 {
            background-color: #333;
            color: #fff;
        }

        .fret .dot, .fret .number, .fret .note {
            visibility: hidden;
        }

        .fret:hover .dot.show-dots {
            visibility: visible;
        }

        .fret:hover .number.show-numbers {
            visibility: visible;
        }

        .fret:hover .note.show-notes {
            visibility: visible;
        }

        .fret:hover {
            background-color: #ddd;
        }

        .fret .dot {
            position: absolute;
            font-size: 20px;
            color: #555;
        }

        .fret .number {
            font-size: 16px;
            color: #000;
        }

        .fret .note {
            font-size: 16px;
            color: #000;
        }

        .note-display {
            margin-top: 20px;
            font-size: 20px;
        }

        .inputs {
            margin-top: 20px;
        }

        .inputs label {
            display: block;
            margin: 5px 0;
        }

        .inputs input, .inputs select {
            width: 60px;
            margin-right: 10px;
        }

        .inputs input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }
    </style>
</head>
<body>

    <h1>Interactive Guitar Fretboard</h1>

    <div class="fretboard" id="fretboard"></div>
    <div class="note-display" id="noteDisplay">Click and hold a fret to play the note!</div>

    <div class="inputs" id="inputs">
        <label for="fret0">Fret 0 Width (px): <input type="number" id="fret0" value="30"></label>
        <label for="fret1">Fret 1 Width (px): <input type="number" id="fret1" value="100"></label>
        <label for="fretHeight">Fret Height (px): <input type="number" id="fretHeight" value="40"></label>
        <label for="stringOrder">String Order:
            <select id="stringOrder">
                <option value="reverse" selected>Reverse (E4 to E2)</option>
                <option value="standard">Standard (E2 to E4)</option>
            </select>
        </label>
        <label>
            Show:
            <select id="displayOption">
                <option value="numbers" selected>Fret Numbers</option>
                <option value="dots">Dots</option>
                <option value="notes1">Note Names Flat</option>
                <option value="notes2">Note Names Sharp</option>
            </select>
        </label>
        <label>
            Hide Right Border:
            <input type="checkbox" id="hideRightBorder" checked>
        </label>
    </div>

    <script>
        const tuningStandard = ['E2', 'A2', 'D3', 'G3', 'B3', 'E4'];
        const frets = 21;
        const highlightFrets = [0, 3, 5, 7, 9, 15, 17, 19, 21];
        const specialFret12 = 12;

        const fretDimensions = {
            width: {
                0: parseInt(document.getElementById('fret0').value) || 30,
                1: parseInt(document.getElementById('fret1').value) || 100,
            },
            height: parseInt(document.getElementById('fretHeight').value) || 40,
        };

        function getFretWidth(fret) {
            if (fret === 0) {
                return `${fretDimensions.width[0]}px`;
            }
            if (fret === 1) {
                return `${fretDimensions.width[1]}px`;
            }
            return `${fretDimensions.width[1] * Math.pow(1 / 1.06, fret - 1)}px`;
        }

        function updateFretDimensions() {
            fretDimensions.width[0] = parseInt(document.getElementById('fret0').value) || 30;
            fretDimensions.width[1] = parseInt(document.getElementById('fret1').value) || 100;
            fretDimensions.height = parseInt(document.getElementById('fretHeight').value) || 40;
            renderFretboard();
        }

        function getFlatEquivalent(note) {
            const noteToFlat = {
                'C#1': 'Db1', 'D#1': 'Eb1', 'F#1': 'Gb1', 'G#1': 'Ab1', 'A#1': 'Bb1',
                // Add the rest of the mappings here
            };
            return noteToFlat[note] || note;
        }

        document.getElementById('fret0').addEventListener('input', updateFretDimensions);
        document.getElementById('fret1').addEventListener('input', updateFretDimensions);
        document.getElementById('fretHeight').addEventListener('input', updateFretDimensions);

        // Triggering audio on mobile using touch events and Tone.js
        let audioStarted = false;

        function startAudio() {
            if (!audioStarted) {
                Tone.start();
                audioStarted = true;
            }
        }

        document.body.addEventListener('touchstart', startAudio);

        // Create the Tone.js synth
        const synth = new Tone.Synth().toDestination();

        // Function to play a note
        function playNote(note) {
            synth.triggerAttackRelease(note, '8n');
        }

        function renderFretboard() {
            const fretboard = document.getElementById('fretboard');
            fretboard.innerHTML = '';
            tuningStandard.forEach((stringTuning, stringIndex) => {
                const stringDiv = document.createElement('div');
                stringDiv.classList.add('string');
                for (let fret = 0; fret <= frets; fret++) {
                    const fretDiv = document.createElement('div');
                    fretDiv.classList.add('fret');
                    if (highlightFrets.includes(fret)) {
                        fretDiv.classList.add('highlight');
                    }
                    if (fret === specialFret12) {
                        fretDiv.classList.add('fret-12');
                    }
                    if (fret === 0) {
                        fretDiv.classList.add('fret-0');
                    }
                    fretDiv.style.width = getFretWidth(fret);
                    fretDiv.style.height = `${fretDimensions.height}px`;

                    // Add event listener to play note when clicked
                    fretDiv.addEventListener('mousedown', () => playNote(Tone.Frequency(stringTuning).transpose(fret).toNote()));
                    fretDiv.addEventListener('touchstart', () => {
                        startAudio();
                        playNote(Tone.Frequency(stringTuning).transpose(fret).toNote());
                    });

                    stringDiv.appendChild(fretDiv);
                }
                fretboard.appendChild(stringDiv);
            });
        }

        renderFretboard();
    </script>

</body>
</html>
