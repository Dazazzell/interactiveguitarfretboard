<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Guitar Fretboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.39/Tone.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            user-select: none; /* Prevent text selection on the entire page */
        }

        .fretboard {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .string {
            display: flex;
        }

        .fret {
            border: 1px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background-color: #f0f0f0; /* Default fret color */
            position: relative;
            user-select: none; /* Prevent text selection on frets */
            height: var(--fret-height, 40px); /* Use CSS variable for fret height */
        }

        .fret.highlight {
            background-color: #FFD700; /* Highlighted frets (0, 3, 5, 7, 9, 15, 17, 19, 21) */
        }

        .fret.fret-12 {
            background-color: #FF6347; /* Unique color for fret 12 */
        }

        .fret.fret-0 {
            background-color: #333; /* Dark grey color for fret 0 */
            color: #fff; /* White color for dot text in dark background */
        }

        /* Hide fret numbers and display dots */
        .fret .number {
            visibility: hidden; /* Hide fret number by default */
        }

        .fret::before {
            content: '•'; /* Dot for default state */
            position: absolute;
            font-size: 20px;
            color: #555;
        }

        .fret:hover .number {
            visibility: hidden; /* Hide fret number on hover */
        }

        .fret:hover::before {
            content: '•'; /* Display dot on hover */
        }

        .fret:hover {
            background-color: #ddd;
        }

        .note-display {
            margin-top: 20px;
            font-size: 20px;
        }

        /* Style for the input fields */
        .inputs {
            margin-top: 20px;
        }

        .inputs label {
            display: block;
            margin: 5px 0;
        }

        .inputs input, .inputs select {
            width: 60px;
            margin-right: 10px;
        }
    </style>
</head>
<body>

    <h1>Interactive Guitar Fretboard</h1>

    <div class="fretboard" id="fretboard"></div>
    <div class="note-display" id="noteDisplay">Click and hold a fret to play the note!</div>

    <div class="inputs" id="inputs">
        <label for="fret0">Fret 0 Width (px): <input type="number" id="fret0" value="30"></label>
        <label for="fret1">Fret 1 Width (px): <input type="number" id="fret1" value="100"></label>
        <label for="fretHeight">Fret Height (px): <input type="number" id="fretHeight" value="40"></label>
        <label for="stringOrder">String Order:
            <select id="stringOrder">
                <option value="reverse" selected>Reverse (E4 to E2)</option>
                <option value="standard">Standard (E2 to E4)</option>
            </select>
        </label>
    </div>

    <script>
        const tuningStandard = ['E2', 'A2', 'D3', 'G3', 'B3', 'E4']; // Standard guitar tuning in MIDI octave notation
        const frets = 21; // Number of frets
        const highlightFrets = [0, 3, 5, 7, 9, 15, 17, 19, 21]; // Frets with special color
        const specialFret12 = 12; // Fret 12 with unique color

        // Object to hold the width and height of each fret
        const fretDimensions = {
            width: {
                0: parseInt(document.getElementById('fret0').value) || 30,
                1: parseInt(document.getElementById('fret1').value) || 100,
            },
            height: parseInt(document.getElementById('fretHeight').value) || 40, // Default height set to 40px
        };

        // Function to get the width of a specific fret
        function getFretWidth(fret) {
            if (fret === 0) {
                return `${fretDimensions.width[0]}px`;
            }
            if (fret === 1) {
                return `${fretDimensions.width[1]}px`;
            }
            return `${fretDimensions.width[1] * Math.pow(1 / 1.06, fret - 1)}px`;
        }

        // Function to get the flat equivalent of a note
        function getFlatEquivalent(note) {
            const noteToFlat = {
                'C#1': 'Db1', 'D#1': 'Eb1', 'F#1': 'Gb1', 'G#1': 'Ab1', 'A#1': 'Bb1',
                'Db1': 'C#1', 'Eb1': 'D#1', 'Gb1': 'F#1', 'Ab1': 'G#1', 'Bb1': 'A#1',
                'C#2': 'Db2', 'D#2': 'Eb2', 'F#2': 'Gb2', 'G#2': 'Ab2', 'A#2': 'Bb2',
                'Db2': 'C#2', 'Eb2': 'D#2', 'Gb2': 'F#2', 'Ab2': 'G#2', 'Bb2': 'A#2',
                'C#3': 'Db3', 'D#3': 'Eb3', 'F#3': 'Gb3', 'G#3': 'Ab3', 'A#3': 'Bb3',
                'Db3': 'C#3', 'Eb3': 'D#3', 'Gb3': 'F#3', 'Ab3': 'G#3', 'Bb3': 'A#3',
                'C#4': 'Db4', 'D#4': 'Eb4', 'F#4': 'Gb4', 'G#4': 'Ab4', 'A#4': 'Bb4',
                'Db4': 'C#4', 'Eb4': 'D#4', 'Gb4': 'F#4', 'Ab4': 'G#4', 'Bb4': 'A#4',
                'C#5': 'Db5', 'D#5': 'Eb5', 'F#5': 'Gb5', 'G#5': 'Ab5', 'A#5': 'Bb5',
                'Db5': 'C#5', 'Eb5': 'D#5', 'Gb5': 'F#5', 'Ab5': 'G#5', 'Bb5': 'A#5',
                'C#6': 'Db6', 'D#6': 'Eb6', 'F#6': 'Gb6', 'G#6': 'Ab6', 'A#6': 'Bb6',
                'Db6': 'C#6', 'Eb6': 'D#6', 'Gb6': 'F#6', 'Ab6': 'G#6', 'Bb6': 'A#6'
                
            };
            return noteToFlat[note] || note;
        }

        // Update fret dimensions based on input values
        function updateFretDimensions() {
            fretDimensions.width[0] = parseInt(document.getElementById('fret0').value) || 30;
            fretDimensions.width[1] = parseInt(document.getElementById('fret1').value) || 100;
            fretDimensions.height = parseInt(document.getElementById('fretHeight').value) || 40;
            renderFretboard(); // Re-render fretboard with updated dimensions
        }

        // Create a synth using Tone.js
        const synth = new Tone.Synth().toDestination();
        let currentNote = null; // To keep track of the currently playing note

        // Function to play the correct note using Tone.js
        function startNote(note) {
            if (currentNote) {
                synth.triggerRelease(); // Release any note currently playing
            }
            currentNote = note;
            synth.triggerAttack(note); // Start playing the note
        }

        // Function to stop the currently playing note
        function stopNote() {
            if (currentNote) {
                synth.triggerRelease(); // Stop the note
                currentNote = null;
            }
        }

        // Function to initialize Tone.js audio context
        function initializeAudioContext() {
            Tone.start().then(() => {
                document.body.removeEventListener('touchstart', initializeAudioContext); // Remove listener once audio context is initialized
                document.body.removeEventListener('mousedown', initializeAudioContext); // Remove listener once audio context is initialized
            });
        }

        // Add listeners to initialize Tone.js context
        document.body.addEventListener('touchstart', initializeAudioContext);
        document.body.addEventListener('mousedown', initializeAudioContext);

        // Create fretboard
        function renderFretboard() {
            const fretboard = document.getElementById('fretboard');
            fretboard.innerHTML = ''; // Clear existing fretboard

            const stringOrder = document.getElementById('stringOrder').value === 'reverse' ? tuningStandard.slice().reverse() : tuningStandard;

            stringOrder.forEach((stringNote, stringIndex) => {
                const stringDiv = document.createElement('div');
                stringDiv.classList.add('string');

                for (let fret = 0; fret <= frets; fret++) {
                    const fretDiv = document.createElement('div');
                    fretDiv.classList.add('fret');
                    fretDiv.style.width = getFretWidth(fret); // Set width based on fret number
                    fretDiv.style.height = `${fretDimensions.height}px`; // Set height based on input value

                    // Apply different colors based on fret numbers
                    if (fret === 0) {
                        fretDiv.classList.add('fret-0');
                    } else if (highlightFrets.includes(fret)) {
                        fretDiv.classList.add('highlight');
                    } else if (fret === specialFret12) {
                        fretDiv.classList.add('fret-12');
                    }

                    // Calculate the note at this string and fret
                    const midiNote = Tone.Frequency(stringNote).transpose(fret).toNote(); // Get the correct note using Tone.js
                    const flatNote = getFlatEquivalent(midiNote); // Get the flat equivalent

                    // Create a span for the fret number and hide it by default
                    const numberSpan = document.createElement('span');
                    numberSpan.classList.add('number');
                    numberSpan.innerText = fret; // Show fret number
                    fretDiv.appendChild(numberSpan);

                    // Add mouse and touch events to start and stop the note
                    fretDiv.addEventListener('mousedown', () => {
                        noteDisplay.innerText = `String: ${tuningStandard.length - stringIndex}, Fret: ${fret}, Note: ${midiNote} / ${flatNote}`;
                        startNote(midiNote); // Start playing the correct note
                    });

                    fretDiv.addEventListener('mouseup', stopNote); // Stop playing the note
                    fretDiv.addEventListener('mouseleave', stopNote); // Stop playing if mouse leaves the fret
                    fretDiv.addEventListener('touchstart', () => {
                        noteDisplay.innerText = `String: ${tuningStandard.length - stringIndex}, Fret: ${fret}, Note: ${midiNote} / ${flatNote}`;
                        startNote(midiNote); // Start playing the correct note
                    }, { passive: true });

                    fretDiv.addEventListener('touchend', stopNote); // Stop playing the note
                    fretDiv.addEventListener('touchcancel', stopNote); // Stop playing if touch is canceled

                    stringDiv.appendChild(fretDiv);
                }

                fretboard.appendChild(stringDiv);
            });
        }

        // Initialize fretboard
        renderFretboard();

        // Update fretboard when input values change
        document.getElementById('fret0').addEventListener('input', updateFretDimensions);
        document.getElementById('fret1').addEventListener('input', updateFretDimensions);
        document.getElementById('fretHeight').addEventListener('input', updateFretDimensions);
        document.getElementById('stringOrder').addEventListener('change', renderFretboard);

    </script>
<a target=_new href=https://www.musicca.com/metronome>https://www.musicca.com/metronome</a>
</body>
</html>
